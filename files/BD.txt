-- V1_0_0__initSchema.sql

CREATE TABLE store (
    id SERIAL PRIMARY KEY,
    city VARCHAR(30) NOT NULL,
    country VARCHAR(30) NOT NULL,
    admin INTEGER NOT NULL
);

CREATE TABLE stock (
    id VARCHAR(255) PRIMARY KEY,
    product_id INT NOT NULL,
    store_id INT NOT NULL,
    quantity INTEGER DEFAULT 0,
    price DECIMAL(19, 2) NOT NULL,
    discount DECIMAL DEFAULT 0,
    min_stock INTEGER DEFAULT 0
);

CREATE INDEX idx_stock_product ON stock (product_id);
CREATE INDEX idx_stock_store ON stock (store_id);


CREATE TABLE category (
    id SERIAL PRIMARY KEY,
    name VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE brand (
    id SERIAL PRIMARY KEY,
    name VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE product (
    id SERIAL PRIMARY KEY,
    name VARCHAR(150) NOT NULL,
    description TEXT NOT NULL,
    sku UUID NOT NULL UNIQUE,
    brand_id INT,
    category_id INT,
    characteristic_id VARCHAR,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    CONSTRAINT fk_brand FOREIGN KEY (brand_id) REFERENCES brand(id),
    CONSTRAINT fk_category FOREIGN KEY (category_id) REFERENCES category(id)
);

CREATE INDEX idx_product_brand ON product(brand_id);
CREATE INDEX idx_product_category ON product(category_id);


CREATE TABLE orders (
    id BIGSERIAL PRIMARY KEY,
    store_id BIGINT NOT NULL,
    address VARCHAR(255) NOT NULL,
    amount DECIMAL(19,2),
    payment_id BIGINT,
    customer_id BIGINT NOT NULL,
    status VARCHAR(50) NOT NULL,
    order_detail_ids VARCHAR(255)[],
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL
);

CREATE TABLE order_details (
    id VARCHAR(255) PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(id),
    product_id BIGINT NOT NULL,
    quantity BIGINT NOT NULL,
    unit_price DECIMAL(19,2) NOT NULL,
    price_with_discount DECIMAL(19,2) NOT NULL,
    subtotal DECIMAL(19,2),
    reserved BOOLEAN NOT NULL
);


CREATE INDEX idx_order_details_order_id ON order_details(order_id);
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_store_id ON orders(store_id);
CREATE INDEX idx_order_details_product_id ON order_details(product_id);



CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20)[] NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    active BOOLEAN NOT NULL DEFAULT true
);


CREATE INDEX idx_users_email ON users(email);



